


ARM Macro Assembler    Page 1 


    1 00000000         ; ------------------------------------------------------
                       ------------
    2 00000000         ; --  _____       ______  _____                         
                                  -
    3 00000000         ; -- |_   _|     |  ____|/ ____|                        
                                  -
    4 00000000         ; --   | |  _ __ | |__  | (___    Institute of Embedded 
                       Systems    -
    5 00000000         ; --   | | | '_ \|  __|  \___ \   Zurich University of  
                                  -
    6 00000000         ; --  _| |_| | | | |____ ____) |  Applied Sciences      
                                  -
    7 00000000         ; -- |_____|_| |_|______|_____/   8401 Winterthur, Switz
                       erland     -
    8 00000000         ; ------------------------------------------------------
                       ------------
    9 00000000         ; --
   10 00000000         ; -- main.s
   11 00000000         ; --
   12 00000000         ; -- CT1 P08 "Strukturierte Codierung" mit Assembler
   13 00000000         ; --
   14 00000000         ; -- $Id: struct_code.s 3787 2016-11-17 09:41:48Z kesr $
                       
   15 00000000         ; ------------------------------------------------------
                       ------------
   16 00000000         ;Directives
   17 00000000                 PRESERVE8
   18 00000000                 THUMB
   19 00000000         
   20 00000000         ; ------------------------------------------------------
                       ------------
   21 00000000         ; -- Address-Defines
   22 00000000         ; ------------------------------------------------------
                       ------------
   23 00000000         ; input
   24 00000000 60000200 
                       ADDR_DIP_SWITCH_7_0
                               EQU              0x60000200
   25 00000000 60000210 
                       ADDR_BUTTONS
                               EQU              0x60000210
   26 00000000         
   27 00000000         ; output
   28 00000000 60000100 
                       ADDR_LED_31_0
                               EQU              0x60000100
   29 00000000 60000114 
                       ADDR_7_SEG_BIN_DS3_0
                               EQU              0x60000114
   30 00000000 60000340 
                       ADDR_LCD_COLOUR
                               EQU              0x60000340
   31 00000000 60000300 
                       ADDR_LCD_ASCII
                               EQU              0x60000300
   32 00000000 60000302 
                       ADDR_LCD_ASCII_BIT_POS
                               EQU              0x60000302
   33 00000000 60000314 



ARM Macro Assembler    Page 2 


                       ADDR_LCD_ASCII_2ND_LINE
                               EQU              0x60000314
   34 00000000         
   35 00000000         
   36 00000000         ; ------------------------------------------------------
                       ------------
   37 00000000         ; -- Program-Defines
   38 00000000         ; ------------------------------------------------------
                       ------------
   39 00000000         ; value for clearing lcd
   40 00000000 00000000 
                       ASCII_DIGIT_CLEAR
                               EQU              0x00000000
   41 00000000 00000028 
                       LCD_LAST_OFFSET
                               EQU              0x00000028
   42 00000000         
   43 00000000         ; offset for showing the digit in the lcd
   44 00000000 00000030 
                       ASCII_DIGIT_OFFSET
                               EQU              0x00000030
   45 00000000         
   46 00000000         ; lcd background colors to be written
   47 00000000 00000000 
                       DISPLAY_COLOUR_RED
                               EQU              0
   48 00000000 00000002 
                       DISPLAY_COLOUR_GREEN
                               EQU              2
   49 00000000 00000004 
                       DISPLAY_COLOUR_BLUE
                               EQU              4
   50 00000000         
   51 00000000         ; ------------------------------------------------------
                       ------------
   52 00000000         ; -- myConstants
   53 00000000         ; ------------------------------------------------------
                       ------------
   54 00000000                 AREA             myConstants, DATA, READONLY
   55 00000000         ; display defines for hex / dec
   56 00000000 42 69 74 
              20       DISPLAY_BIT
                               DCB              "Bit "
   57 00000004 32      DISPLAY_2_BIT
                               DCB              "2"
   58 00000005 34      DISPLAY_4_BIT
                               DCB              "4"
   59 00000006 38      DISPLAY_8_BIT
                               DCB              "8"
   60 00000007 00              ALIGN
   61 00000008         
   62 00000008         ; ------------------------------------------------------
                       ------------
   63 00000008         ; -- myCode
   64 00000008         ; ------------------------------------------------------
                       ------------
   65 00000008                 AREA             myCode, CODE, READONLY
   66 00000000                 ENTRY
   67 00000000         



ARM Macro Assembler    Page 3 


   68 00000000         ; imports for calls
   69 00000000                 import           adc_init
   70 00000000                 import           adc_get_value
   71 00000000         
   72 00000000         main    PROC
   73 00000000                 export           main
   74 00000000         ; 8 bit resolution, cont. sampling
   75 00000000 F7FF FFFE       BL               adc_init
   76 00000004 F000 F843       BL               clear_lcd
   77 00000008         
   78 00000008         main_loop
   79 00000008         ; STUDENTS: To be programmed
   80 00000008         
   81 00000008 F000 F83A       BL               clear_lcd_color
   82 0000000C F7FF FFFE       BL               adc_get_value ;R0 = ADC
   83 00000010         
   84 00000010         ; read T0
   85 00000010 4F28            LDR              R7, =ADDR_BUTTONS
   86 00000012 783A            LDRB             R2, [R7]
   87 00000014 0852            LSRS             R2, R2, #1
   88 00000016 D315            BCC              no_button
   89 00000018         
   90 00000018         ; ADC Value
   91 00000018 4F27            LDR              R7, =ADDR_7_SEG_BIN_DS3_0
   92 0000001A 7038            STRB             R0, [R7]
   93 0000001C         
   94 0000001C         ; LCD to Green
   95 0000001C 4F27            LDR              R7, =ADDR_LCD_COLOUR
   96 0000001E 4E28            LDR              R6, =0xFFFF
   97 00000020 807E            STRH             R6, [R7, #2]
   98 00000022         
   99 00000022 0003            MOVS             R3, R0      ; 40 -> 00101000
  100 00000024 2600            MOVS             R6, #0      ; 1
  101 00000026         
  102 00000026 08DB            LSRS             R3, R3, #3
  103 00000028 1C5B            ADDS             R3, R3, #1
  104 0000002A 001E            MOVS             R6, R3
  105 0000002C         
  106 0000002C         ; display LED bar
  107 0000002C 2300            MOVS             R3, #0      ; shifts R6 times l
                                                            eft with ones. resu
                                                            lt in R3.
  108 0000002E F000 F803       BL               test_fl
  109 00000032         fill_loop
  110 00000032 005B            LSLS             R3, R3, #1
  111 00000034 1C5B            ADDS             R3, R3, #1
  112 00000036 1E76            SUBS             R6, R6, #1
  113 00000038         test_fl
  114 00000038 2E00            CMP              R6, #0
  115 0000003A D8FA            BHI              fill_loop
  116 0000003C         
  117 0000003C         ; print to led
  118 0000003C 4F21            LDR              R7, =ADDR_LED_31_0
  119 0000003E 603B            STR              R3, [R7]
  120 00000040         
  121 00000040 F000 F81D       BL               end_no_button
  122 00000044         
  123 00000044         no_button
  124 00000044         ; load DIP switchs



ARM Macro Assembler    Page 4 


  125 00000044 4F20            LDR              R7, =ADDR_DIP_SWITCH_7_0
  126 00000046 783A            LDRB             R2, [R7]
  127 00000048         
  128 00000048 1A12            SUBS             R2, R2, R0
  129 0000004A D413            BMI              red
  130 0000004C         
  131 0000004C 2A10            CMP              R2, #16
  132 0000004E DA07            BGE              bit_8
  133 00000050 2A04            CMP              R2, #4
  134 00000052 DA02            BGE              bit_4
  135 00000054         
  136 00000054 4E1D            LDR              R6, =DISPLAY_2_BIT
  137 00000056 F000 F804       BL               bit_end
  138 0000005A         bit_4
  139 0000005A 4E1D            LDR              R6, =DISPLAY_4_BIT
  140 0000005C F000 F801       BL               bit_end
  141 00000060         bit_8
  142 00000060 4E1C            LDR              R6, =DISPLAY_8_BIT
  143 00000062         bit_end
  144 00000062         
  145 00000062 4F1D            LDR              R7, =ADDR_LCD_ASCII
  146 00000064 803E            STRH             R6, [R7]
  147 00000066 F000 F81D       BL               write_bit_ascii
  148 0000006A         
  149 0000006A         ; LCD to Blue
  150 0000006A 4F14            LDR              R7, =ADDR_LCD_COLOUR
  151 0000006C 4E14            LDR              R6, =0xFFFF
  152 0000006E 80BE            STRH             R6, [R7, #4]
  153 00000070 F000 F803       BL               end_red
  154 00000074         
  155 00000074         red
  156 00000074         ; LCD to Blue
  157 00000074 4F11            LDR              R7, =ADDR_LCD_COLOUR
  158 00000076 4E12            LDR              R6, =0xFFFF
  159 00000078 803E            STRH             R6, [R7]
  160 0000007A         
  161 0000007A         end_red
  162 0000007A 4F0F            LDR              R7, =ADDR_7_SEG_BIN_DS3_0
  163 0000007C 703A            STRB             R2, [R7]
  164 0000007E         
  165 0000007E         end_no_button
  166 0000007E         
  167 0000007E         ; END: To be programmed
  168 0000007E E7C3            B                main_loop
  169 00000080         
  170 00000080         
  171 00000080         clear_lcd_color
  172 00000080 B4C0            PUSH             {R6, R7}
  173 00000082 4F0E            LDR              R7, =ADDR_LCD_COLOUR
  174 00000084 2600            MOVS             R6, #0
  175 00000086 603E            STR              R6, [R7]
  176 00000088 80BE            STRH             R6, [R7, #4]
  177 0000008A BCC0            POP              {R6, R7}
  178 0000008C 4770            BX               LR
  179 0000008E         
  180 0000008E         clear_lcd
  181 0000008E B407            PUSH             {R0, R1, R2}
  182 00000090 4A12            LDR              R2, =0x0
  183 00000092         clear_lcd_loop



ARM Macro Assembler    Page 5 


  184 00000092 4811            LDR              R0, =ADDR_LCD_ASCII
  185 00000094 1880            ADDS             R0, R0, R2  ; add index to lcd 
                                                            offset
  186 00000096 4911            LDR              R1, =ASCII_DIGIT_CLEAR
  187 00000098 6001            STR              R1, [R0]
  188 0000009A 1D12            ADDS             R2, R2, #4  ; increas index by 
                                                            4 (word step)
  189 0000009C 2A28            CMP              R2, #LCD_LAST_OFFSET ; until in
                                                            dex reached last lc
                                                            d point
  190 0000009E D4F8            BMI              clear_lcd_loop
  191 000000A0 BC07            POP              {R0, R1, R2}
  192 000000A2 4770            BX               LR
  193 000000A4         
  194 000000A4         write_bit_ascii
  195 000000A4 B403            PUSH             {R0, R1}
  196 000000A6 480E            LDR              R0, =ADDR_LCD_ASCII_BIT_POS
  197 000000A8 490E            LDR              R1, =DISPLAY_BIT
  198 000000AA 6809            LDR              R1, [R1]
  199 000000AC 6001            STR              R1, [R0]
  200 000000AE BC03            POP              {R0, R1}
  201 000000B0 4770            BX               LR
  202 000000B2         
  203 000000B2                 ENDP
  204 000000B2 00 00           ALIGN
  205 000000B4         
  206 000000B4         
  207 000000B4         ; ------------------------------------------------------
                       ------------
  208 000000B4         ; End of code
  209 000000B4         ; ------------------------------------------------------
                       ------------
  210 000000B4                 END
              60000210 
              60000114 
              60000340 
              0000FFFF 
              60000100 
              60000200 
              00000000 
              00000000 
              00000000 
              60000300 
              00000000 
              60000302 
              00000000 
Command Line: --debug --xref --diag_suppress=9931 --cpu=Cortex-M0 --apcs=interw
ork --depend=.\build\struct_code.d -o.\build\struct_code.o -I.\RTE\_Target_1 -I
C:\Users\joelp\AppData\Local\Arm\Packs\InES\CTBoard14_DFP\4.0.2\Device\Include 
-IC:\Users\joelp\AppData\Local\Arm\Packs\InES\CTBoard14_DFP\4.0.2\Device\Includ
e\m0 -IC:\Users\joelp\AppData\Local\Arm\Packs\InES\CTBoard14_DFP\4.0.2\HAL\Incl
ude -IC:\Keil_v5\ARM\CMSIS\Include --predefine="__EVAL SETA 1" --predefine="__U
VISION_VERSION SETA 531" --predefine="_RTE_ SETA 1" --predefine="_RTE_ SETA 1" 
--list=.\build\struct_code.lst app\struct_code.s



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

DISPLAY_2_BIT 00000004

Symbol: DISPLAY_2_BIT
   Definitions
      At line 57 in file app\struct_code.s
   Uses
      At line 136 in file app\struct_code.s
Comment: DISPLAY_2_BIT used once
DISPLAY_4_BIT 00000005

Symbol: DISPLAY_4_BIT
   Definitions
      At line 58 in file app\struct_code.s
   Uses
      At line 139 in file app\struct_code.s
Comment: DISPLAY_4_BIT used once
DISPLAY_8_BIT 00000006

Symbol: DISPLAY_8_BIT
   Definitions
      At line 59 in file app\struct_code.s
   Uses
      At line 142 in file app\struct_code.s
Comment: DISPLAY_8_BIT used once
DISPLAY_BIT 00000000

Symbol: DISPLAY_BIT
   Definitions
      At line 56 in file app\struct_code.s
   Uses
      At line 197 in file app\struct_code.s
Comment: DISPLAY_BIT used once
myConstants 00000000

Symbol: myConstants
   Definitions
      At line 54 in file app\struct_code.s
   Uses
      None
Comment: myConstants unused
5 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

bit_4 0000005A

Symbol: bit_4
   Definitions
      At line 138 in file app\struct_code.s
   Uses
      At line 134 in file app\struct_code.s
Comment: bit_4 used once
bit_8 00000060

Symbol: bit_8
   Definitions
      At line 141 in file app\struct_code.s
   Uses
      At line 132 in file app\struct_code.s
Comment: bit_8 used once
bit_end 00000062

Symbol: bit_end
   Definitions
      At line 143 in file app\struct_code.s
   Uses
      At line 137 in file app\struct_code.s
      At line 140 in file app\struct_code.s

clear_lcd 0000008E

Symbol: clear_lcd
   Definitions
      At line 180 in file app\struct_code.s
   Uses
      At line 76 in file app\struct_code.s
Comment: clear_lcd used once
clear_lcd_color 00000080

Symbol: clear_lcd_color
   Definitions
      At line 171 in file app\struct_code.s
   Uses
      At line 81 in file app\struct_code.s
Comment: clear_lcd_color used once
clear_lcd_loop 00000092

Symbol: clear_lcd_loop
   Definitions
      At line 183 in file app\struct_code.s
   Uses
      At line 190 in file app\struct_code.s
Comment: clear_lcd_loop used once
end_no_button 0000007E

Symbol: end_no_button
   Definitions
      At line 165 in file app\struct_code.s
   Uses
      At line 121 in file app\struct_code.s
Comment: end_no_button used once
end_red 0000007A




ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Relocatable symbols

Symbol: end_red
   Definitions
      At line 161 in file app\struct_code.s
   Uses
      At line 153 in file app\struct_code.s
Comment: end_red used once
fill_loop 00000032

Symbol: fill_loop
   Definitions
      At line 109 in file app\struct_code.s
   Uses
      At line 115 in file app\struct_code.s
Comment: fill_loop used once
main 00000000

Symbol: main
   Definitions
      At line 72 in file app\struct_code.s
   Uses
      At line 73 in file app\struct_code.s
Comment: main used once
main_loop 00000008

Symbol: main_loop
   Definitions
      At line 78 in file app\struct_code.s
   Uses
      At line 168 in file app\struct_code.s
Comment: main_loop used once
myCode 00000000

Symbol: myCode
   Definitions
      At line 65 in file app\struct_code.s
   Uses
      None
Comment: myCode unused
no_button 00000044

Symbol: no_button
   Definitions
      At line 123 in file app\struct_code.s
   Uses
      At line 88 in file app\struct_code.s
Comment: no_button used once
red 00000074

Symbol: red
   Definitions
      At line 155 in file app\struct_code.s
   Uses
      At line 129 in file app\struct_code.s
Comment: red used once
test_fl 00000038

Symbol: test_fl
   Definitions
      At line 113 in file app\struct_code.s



ARM Macro Assembler    Page 3 Alphabetic symbol ordering
Relocatable symbols

   Uses
      At line 108 in file app\struct_code.s
Comment: test_fl used once
write_bit_ascii 000000A4

Symbol: write_bit_ascii
   Definitions
      At line 194 in file app\struct_code.s
   Uses
      At line 147 in file app\struct_code.s
Comment: write_bit_ascii used once
16 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Absolute symbols

ADDR_7_SEG_BIN_DS3_0 60000114

Symbol: ADDR_7_SEG_BIN_DS3_0
   Definitions
      At line 29 in file app\struct_code.s
   Uses
      At line 91 in file app\struct_code.s
      At line 162 in file app\struct_code.s

ADDR_BUTTONS 60000210

Symbol: ADDR_BUTTONS
   Definitions
      At line 25 in file app\struct_code.s
   Uses
      At line 85 in file app\struct_code.s
Comment: ADDR_BUTTONS used once
ADDR_DIP_SWITCH_7_0 60000200

Symbol: ADDR_DIP_SWITCH_7_0
   Definitions
      At line 24 in file app\struct_code.s
   Uses
      At line 125 in file app\struct_code.s
Comment: ADDR_DIP_SWITCH_7_0 used once
ADDR_LCD_ASCII 60000300

Symbol: ADDR_LCD_ASCII
   Definitions
      At line 31 in file app\struct_code.s
   Uses
      At line 145 in file app\struct_code.s
      At line 184 in file app\struct_code.s

ADDR_LCD_ASCII_2ND_LINE 60000314

Symbol: ADDR_LCD_ASCII_2ND_LINE
   Definitions
      At line 33 in file app\struct_code.s
   Uses
      None
Comment: ADDR_LCD_ASCII_2ND_LINE unused
ADDR_LCD_ASCII_BIT_POS 60000302

Symbol: ADDR_LCD_ASCII_BIT_POS
   Definitions
      At line 32 in file app\struct_code.s
   Uses
      At line 196 in file app\struct_code.s
Comment: ADDR_LCD_ASCII_BIT_POS used once
ADDR_LCD_COLOUR 60000340

Symbol: ADDR_LCD_COLOUR
   Definitions
      At line 30 in file app\struct_code.s
   Uses
      At line 95 in file app\struct_code.s
      At line 150 in file app\struct_code.s
      At line 157 in file app\struct_code.s



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Absolute symbols

      At line 173 in file app\struct_code.s

ADDR_LED_31_0 60000100

Symbol: ADDR_LED_31_0
   Definitions
      At line 28 in file app\struct_code.s
   Uses
      At line 118 in file app\struct_code.s
Comment: ADDR_LED_31_0 used once
ASCII_DIGIT_CLEAR 00000000

Symbol: ASCII_DIGIT_CLEAR
   Definitions
      At line 40 in file app\struct_code.s
   Uses
      At line 186 in file app\struct_code.s
Comment: ASCII_DIGIT_CLEAR used once
ASCII_DIGIT_OFFSET 00000030

Symbol: ASCII_DIGIT_OFFSET
   Definitions
      At line 44 in file app\struct_code.s
   Uses
      None
Comment: ASCII_DIGIT_OFFSET unused
DISPLAY_COLOUR_BLUE 00000004

Symbol: DISPLAY_COLOUR_BLUE
   Definitions
      At line 49 in file app\struct_code.s
   Uses
      None
Comment: DISPLAY_COLOUR_BLUE unused
DISPLAY_COLOUR_GREEN 00000002

Symbol: DISPLAY_COLOUR_GREEN
   Definitions
      At line 48 in file app\struct_code.s
   Uses
      None
Comment: DISPLAY_COLOUR_GREEN unused
DISPLAY_COLOUR_RED 00000000

Symbol: DISPLAY_COLOUR_RED
   Definitions
      At line 47 in file app\struct_code.s
   Uses
      None
Comment: DISPLAY_COLOUR_RED unused
LCD_LAST_OFFSET 00000028

Symbol: LCD_LAST_OFFSET
   Definitions
      At line 41 in file app\struct_code.s
   Uses
      At line 189 in file app\struct_code.s
Comment: LCD_LAST_OFFSET used once
14 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
External symbols

adc_get_value 00000000

Symbol: adc_get_value
   Definitions
      At line 70 in file app\struct_code.s
   Uses
      At line 82 in file app\struct_code.s
Comment: adc_get_value used once
adc_init 00000000

Symbol: adc_init
   Definitions
      At line 69 in file app\struct_code.s
   Uses
      At line 75 in file app\struct_code.s
Comment: adc_init used once
2 symbols
372 symbols in table
